{% extends "base.html" %}

{% block content %}
<h1>Swap ETH for RDN</h1>
<div class="hero">
  Choose between Kyber and Uniswap decentralized exchanges to get RDN
</div>
<div class="info-panel">
  <p>Available funds</p>
  <ul class="account-info">
    <li>
      <span class="account-eth-balance highlighted">N/A ETH</span>
    </li>
    <li>
      <span class="account-rdn-balance highlighted">N/A RDN</span>
    </li>
  </ul>
</div>
<div class="action split-2">
  <div>
    <button class="link-button" data-link-url="{{ reverse_url('swap', 'kyber', configuration_file.file_name)}}"
            {% if not kyber.is_listing_token('RDN') %}disabled{% end %}>
      KyberNetwork
    </button>
  </div>
  <div>
  <button class="link-button" data-link-url="{{ reverse_url('swap', 'uniswap', configuration_file.file_name)}}"
          {% if not uniswap.is_listing_token('RDN') %}disabled{% end %}>
    Uniswap
  </button>
  </div>
</div>
{% end %}

{% block page_header_scripts %}
<script type="text/javascript">
 function checkBalances(){
   let url = "{{ reverse_url('api-configuration-detail', configuration_file.file_name) }}";
   let req = new XMLHttpRequest();
   let eth_balance_display_element = document.querySelector("span.account-eth-balance");
   let rdn_balance_display_element = document.querySelector("span.account-rdn-balance");

   req.open("GET", url);
   req.setRequestHeader("Content-Type", "application/json");

   req.onload = function() {
     if (this.status == 200){
       let balance = JSON.parse(this.response).balance;

       if (balance && balance.ETH) {
         eth_balance_display_element.textContent = balance && balance.ETH.formatted;
       }

       if (balance && balance.RDN) {
         rdn_balance_display_element.textContent = balance && balance.RDN.formatted;
       }
     }
   }
   req.send();

 }

 window.addEventListener("load", function() {
   checkBalances();
   setInterval(checkBalances, 5000);
 });


</script>
{% end %}
